!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r=e();for(var i in r)("object"==typeof exports?exports:t)[i]=r[i]}}(window,(function(){return function(t){var e={};function r(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(i,o,function(e){return t[e]}.bind(null,o));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(1);e.Detector=i.Detector},function(t,e,r){"use strict";var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a=function(t){function e(){var e=t.call(this)||this;return e.stat=new s,e}return o(e,t),e.prototype.start=function(t,e){var r=this,i=this.stat;this.stop(),e&&(this.checkIntervalId=window.setInterval((function(){t&&t.getStats(null).then((function(t){i.update(t),r.emit("update",i)}))}),e))},e.prototype.stop=function(){this.checkIntervalId&&clearInterval(this.checkIntervalId)},e}(n(r(2)).default);e.Detector=a;var s=function(){function t(){this.timestamp=0,this.timestampStart=0,this.packetsLost=0,this.frame={decoded:0,dropped:0,received:0,decodedStart:0,height:0,width:0},this.bytes={received:0,receivedStart:0},this.bitrate={current:0,average:0,low:1/0,high:-1/0},this.framerate={current:0,average:0,low:1/0,high:-1/0}}return t.prototype.update=function(t){var e=this;t.forEach((function(t){var r=t.type,i=t.isRemote,o=t.mediaType,n=t.id,a=t.timestamp,s=t.bytesReceived,c=t.framesDropped,u=t.framesReceived,f=t.frameWidth,d=t.frameHeight,p=t.framesDecoded,h=t.packetsLost,l=t.currentRoundTripTime;"inbound-rtp"!==r||i||"video"!==o&&!n.toLowerCase().includes("video")||(e.calBitrate(t),e.calFrameRate(t),e.timestamp=a,e.timestampStart=e.timestampStart||a,e.packetsLost=h,e.bytes={received:s,receivedStart:e.bytes.receivedStart||s}),"candidate-pair"===r&&t.hasOwnProperty("currentRoundTripTime")&&(e.currentRoundTripTime=l),"track"===r&&(e.frame={dropped:c,received:u,decoded:p,width:f,height:d,decodedStart:e.frame.decodedStart||p})}))},t.prototype.calFrameRate=function(t){var e=this.frame,r=e.decoded,i=e.decodedStart;if(r&&i){var o=~~((t.framesDecoded-r)/((t.timestamp-this.timestamp)/1e3)),n=Math.min(this.framerate.low,o),a=Math.max(this.framerate.high,o),s=~~((t.framesDecoded-i)/((t.timestamp-this.timestampStart)/1e3));this.framerate={current:o,low:n,high:a,average:s}}},t.prototype.calBitrate=function(t){var e=this.timestamp,r=this.bytes,i=r.received,o=r.receivedStart;if(i&&o&&e){var n=~~(8*(t.bytesReceived-i)/(t.timestamp-e)),a=Math.min(n,this.bitrate.low),s=Math.max(n,this.bitrate.high),c=~~(8*(t.bytesReceived-o)/(t.timestamp-this.timestampStart));Object.assign(this.bitrate,{current:n,low:a,high:s,average:c})}},t.prototype.formatBytes=function(t){for(var e=t,r="B",i=["kB","MB","GB"],o=0,n=i.length;o<n&&!(e<1e3);o++)e/=1e3,r=i[o];return""+e.toFixed(1)+r},t}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.events={}}return t.prototype.hasListener=function(t){var e=this.events;return!!(e&&e[t]&&e[t].length>0)},t.prototype.on=function(t,e,r,i){var o=this;void 0===i&&(i=!1);for(var n=this.events,a=0,s=[].concat(t);a<s.length;a++){var c=s[a];n[c]||(n[c]=[]),n[c].push([e,r,i])}return function(){return o.off(t,e)}},t.prototype.off=function(t,e){if(t||e){for(var r=this.events,i=0,o=[].concat(t);i<o.length;i++){var n=o[i];void 0!==r[n]&&(void 0!==e?r[n]=r[n].filter((function(t){return t[0]!==e})):r[n].length=0)}return this}this.events={}},t.prototype.emit=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];for(var i=!1,o=this.events[t]||[],n=0,a=o;n<a.length;n++){var s=a[n];try{var c=s[0],u=s[1],f=void 0===u?this:u,d=s[2],p=void 0!==d&&d,h=c.apply(f,e);p&&this.off(t,c),!1===h&&(i=!0)}catch(t){console.log(t)}}return i},t}();e.default=i}])}));
//# sourceMappingURL=index.js.map